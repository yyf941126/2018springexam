A = imread('bill.jpg');
A_1 = im2double(A(:,:,1));
A_2 = im2double(A(:,:,2));
A_3 = im2double(A(:,:,3));
A_10 = A_1(1:248,1:248);
A_20 = A_2(1:248,1:248);
A_30 = A_3(1:248,1:248);
B(:,:,1) = A_10;
B(:,:,2) = A_20;
B(:,:,3) = A_30;
B;
%randomlization
X = zeros(8,8);
for i = 1:8
    for j = 1:8
        M(:,:,1,i+(j-1)*8) = B((i-1)*31+1:i*31,(j-1)*31+1:j*31,1);
        M(:,:,2,i+(j-1)*8) = B((i-1)*31+1:i*31,(j-1)*31+1:j*31,2);
        M(:,:,3,i+(j-1)*8) = B((i-1)*31+1:i*31,(j-1)*31+1:j*31,3);
        X(i,j) = i+(j-1)*8;
    end
end
%SSD norm
D = zeros(8,7);
for m = 1:8
    for n = 1:7
        for k = 1:8
            mo = mod(m+n,8);
            if mo == 0
                mo = 8;
            end
            D(m,n) = D(m,n)+...
                sum(abs(M(1:31,1,1,k+(m-1)*8)-M(1:31,31,1,k+(mo-1)*8)).^0.3)+...
                sum(abs(M(1:31,1,2,k+(m-1)*8)-M(1:31,31,2,k+(mo-1)*8)).^0.3)+...
                sum(abs(M(1:31,1,3,k+(m-1)*8)-M(1:31,31,3,k+(mo-1)*8)).^0.3);
        end
    end
end
d = sum(D,2);
d = d.^(5/24);
left = find(d == max(d));
for k =1:8
    B(1+(k-1)*31:31+(k-1)*31,1:31,1) = M(:,:,1,(left-1)*8+k); 
    B(1+(k-1)*31:31+(k-1)*31,1:31,2) = M(:,:,2,(left-1)*8+k); 
    B(1+(k-1)*31:31+(k-1)*31,1:31,3) = M(:,:,3,(left-1)*8+k);
end
    M(:,:,:,(left-1)*8+1:left*8)=[];
for r = 1:7
    d_r = zeros(1,8-r);
    for n = 1:(8-r)
        for k = 1:8
            d_r(n) = d_r(n)+...
                sum(abs(B(1+(k-1)*31:31+(k-1)*31,31*r,1)-M(1:31,1,1,k+(n-1)*8)).^0.3)+...
                sum(abs(B(1+(k-1)*31:31+(k-1)*31,31*r,2)-M(1:31,1,2,k+(n-1)*8)).^0.3)+...
                sum(abs(B(1+(k-1)*31:31+(k-1)*31,31*r,3)-M(1:31,1,3,k+(n-1)*8)).^0.3);
        end
    end
    d_r = d_r.^(5/24);
        right = find(d_r == min(d_r));
        for k =1:8
            B(1+(k-1)*31:31+(k-1)*31,31*r+1:31*(r+1),1) = M(:,:,1,(right-1)*8+k); 
            B(1+(k-1)*31:31+(k-1)*31,31*r+1:31*(r+1),2) = M(:,:,2,(right-1)*8+k); 
            B(1+(k-1)*31:31+(k-1)*31,31*r+1:31*(r+1),3) = M(:,:,3,(right-1)*8+k);
        end
        M(:,:,:,(right-1)*8+1:right*8)=[];
end
for i = 1:8
        M1(:,:,1,i) = B((i-1)*31+1:i*31,1:248,1);
        M1(:,:,2,i) = B((i-1)*31+1:i*31,1:248,2);
        M1(:,:,3,i) = B((i-1)*31+1:i*31,1:248,3);
end
D1 = zeros(8,1);
for m = 1:8
    for n = 1:7
        mo = mod(m+n,8);
        if mo == 0
            mo = 8;
        end
            D1(m) = D1(m)+...
                sum(abs(M1(1,1:248,1,m)-M1(31,1:248,1,mo)).^0.3)+...
                sum(abs(M1(1,1:248,2,m)-M1(31,1:248,2,mo)).^0.3)+...
                sum(abs(M1(1,1:248,3,m)-M1(31,1:248,3,mo)).^0.3);
    end
end
D1 = D1.^(5/24);
upper = find(D1 == max(D1));
B(1:31,:,1) = M1(:,:,1,upper); 
B(1:31,:,2) = M1(:,:,2,upper); 
B(1:31,:,3) = M1(:,:,3,upper);
M1(:,:,:,upper) = [];
for r = 1:7
    D_r = zeros(1,8-r);
    for n = 1:(8-r)
        D_r(n) = D_r(n)+...
            sum(abs(B(r*31,1:248,1)-M1(1,1:248,1,n)).^0.3)+...
            sum(abs(B(r*31,1:248,2)-M1(1,1:248,2,n)).^0.3)+...
            sum(abs(B(r*31,1:248,3)-M1(1,1:248,3,n)).^0.3);
    end
    D_r = D_r.^(5/24);
    down = find(D_r == min(D_r));
    
    B(1+r*31:(r+1)*31,1:248,1) = M1(:,:,1,down); 
    B(1+r*31:(r+1)*31,1:248,2) = M1(:,:,2,down); 
    B(1+r*31:(r+1)*31,1:248,3) = M1(:,:,3,down);
    M1(:,:,:,down)=[];
end
size(M1)
size(B)
subplot(2,1,1);
imshow(A)
subplot(2,1,2);
imshow(B);